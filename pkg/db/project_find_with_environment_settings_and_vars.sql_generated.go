// Code generated by sqlc. DO NOT EDIT.
// versions:
//   sqlc v1.30.0
// source: project_find_with_environment_settings_and_vars.sql

package db

import (
	"context"
)

const findProjectWithEnvironmentSettingsAndVars = `-- name: FindProjectWithEnvironmentSettingsAndVars :one
SELECT
    p.pk, p.id, p.workspace_id, p.name, p.slug, p.default_branch, p.depot_project_id, p.delete_protection, p.created_at, p.updated_at,
    e.pk, e.id, e.workspace_id, e.project_id, e.slug, e.description, e.delete_protection, e.created_at, e.updated_at,
    ebs.pk, ebs.workspace_id, ebs.environment_id, ebs.dockerfile, ebs.docker_context, ebs.created_at, ebs.updated_at,
    ers.pk, ers.workspace_id, ers.environment_id, ers.port, ers.cpu_millicores, ers.memory_mib, ers.command, ers.healthcheck, ers.region_config, ers.shutdown_signal, ers.sentinel_config, ers.created_at, ers.updated_at,
    COALESCE(
        (SELECT JSON_ARRAYAGG(JSON_OBJECT('key', ev.` + "`" + `key` + "`" + `, 'value', ev.value))
         FROM environment_variables ev
         WHERE ev.environment_id = e.id),
        JSON_ARRAY()
    ) AS environment_variables
FROM projects p
INNER JOIN environments e
    ON e.project_id = p.id AND e.workspace_id = p.workspace_id
INNER JOIN environment_build_settings ebs
    ON ebs.environment_id = e.id
INNER JOIN environment_runtime_settings ers
    ON ers.environment_id = e.id
WHERE p.id = ?
  AND e.slug = ?
`

type FindProjectWithEnvironmentSettingsAndVarsParams struct {
	ProjectID string `db:"project_id"`
	Slug      string `db:"slug"`
}

type FindProjectWithEnvironmentSettingsAndVarsRow struct {
	Project                   Project                   `db:"project"`
	Environment               Environment               `db:"environment"`
	EnvironmentBuildSetting   EnvironmentBuildSetting   `db:"environment_build_setting"`
	EnvironmentRuntimeSetting EnvironmentRuntimeSetting `db:"environment_runtime_setting"`
	EnvironmentVariables      interface{}               `db:"environment_variables"`
}

// FindProjectWithEnvironmentSettingsAndVars
//
//	SELECT
//	    p.pk, p.id, p.workspace_id, p.name, p.slug, p.default_branch, p.depot_project_id, p.delete_protection, p.created_at, p.updated_at,
//	    e.pk, e.id, e.workspace_id, e.project_id, e.slug, e.description, e.delete_protection, e.created_at, e.updated_at,
//	    ebs.pk, ebs.workspace_id, ebs.environment_id, ebs.dockerfile, ebs.docker_context, ebs.created_at, ebs.updated_at,
//	    ers.pk, ers.workspace_id, ers.environment_id, ers.port, ers.cpu_millicores, ers.memory_mib, ers.command, ers.healthcheck, ers.region_config, ers.shutdown_signal, ers.sentinel_config, ers.created_at, ers.updated_at,
//	    COALESCE(
//	        (SELECT JSON_ARRAYAGG(JSON_OBJECT('key', ev.`key`, 'value', ev.value))
//	         FROM environment_variables ev
//	         WHERE ev.environment_id = e.id),
//	        JSON_ARRAY()
//	    ) AS environment_variables
//	FROM projects p
//	INNER JOIN environments e
//	    ON e.project_id = p.id AND e.workspace_id = p.workspace_id
//	INNER JOIN environment_build_settings ebs
//	    ON ebs.environment_id = e.id
//	INNER JOIN environment_runtime_settings ers
//	    ON ers.environment_id = e.id
//	WHERE p.id = ?
//	  AND e.slug = ?
func (q *Queries) FindProjectWithEnvironmentSettingsAndVars(ctx context.Context, db DBTX, arg FindProjectWithEnvironmentSettingsAndVarsParams) (FindProjectWithEnvironmentSettingsAndVarsRow, error) {
	row := db.QueryRowContext(ctx, findProjectWithEnvironmentSettingsAndVars, arg.ProjectID, arg.Slug)
	var i FindProjectWithEnvironmentSettingsAndVarsRow
	err := row.Scan(
		&i.Project.Pk,
		&i.Project.ID,
		&i.Project.WorkspaceID,
		&i.Project.Name,
		&i.Project.Slug,
		&i.Project.DefaultBranch,
		&i.Project.DepotProjectID,
		&i.Project.DeleteProtection,
		&i.Project.CreatedAt,
		&i.Project.UpdatedAt,
		&i.Environment.Pk,
		&i.Environment.ID,
		&i.Environment.WorkspaceID,
		&i.Environment.ProjectID,
		&i.Environment.Slug,
		&i.Environment.Description,
		&i.Environment.DeleteProtection,
		&i.Environment.CreatedAt,
		&i.Environment.UpdatedAt,
		&i.EnvironmentBuildSetting.Pk,
		&i.EnvironmentBuildSetting.WorkspaceID,
		&i.EnvironmentBuildSetting.EnvironmentID,
		&i.EnvironmentBuildSetting.Dockerfile,
		&i.EnvironmentBuildSetting.DockerContext,
		&i.EnvironmentBuildSetting.CreatedAt,
		&i.EnvironmentBuildSetting.UpdatedAt,
		&i.EnvironmentRuntimeSetting.Pk,
		&i.EnvironmentRuntimeSetting.WorkspaceID,
		&i.EnvironmentRuntimeSetting.EnvironmentID,
		&i.EnvironmentRuntimeSetting.Port,
		&i.EnvironmentRuntimeSetting.CpuMillicores,
		&i.EnvironmentRuntimeSetting.MemoryMib,
		&i.EnvironmentRuntimeSetting.Command,
		&i.EnvironmentRuntimeSetting.Healthcheck,
		&i.EnvironmentRuntimeSetting.RegionConfig,
		&i.EnvironmentRuntimeSetting.ShutdownSignal,
		&i.EnvironmentRuntimeSetting.SentinelConfig,
		&i.EnvironmentRuntimeSetting.CreatedAt,
		&i.EnvironmentRuntimeSetting.UpdatedAt,
		&i.EnvironmentVariables,
	)
	return i, err
}
