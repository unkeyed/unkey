// Code generated by sqlc. DO NOT EDIT.
// versions:
//   sqlc v1.30.0
// source: certificate_find_expiring_ocsp.sql

package db

import (
	"context"
	"database/sql"
)

const findCertificatesWithExpiringOCSP = `-- name: FindCertificatesWithExpiringOCSP :many
SELECT pk, id, workspace_id, hostname, certificate, ocsp_staple, ocsp_expires_at
FROM certificates
WHERE ocsp_expires_at IS NULL OR ocsp_expires_at < ?
LIMIT 1000
`

type FindCertificatesWithExpiringOCSPRow struct {
	Pk            uint64        `db:"pk"`
	ID            string        `db:"id"`
	WorkspaceID   string        `db:"workspace_id"`
	Hostname      string        `db:"hostname"`
	Certificate   string        `db:"certificate"`
	OcspStaple    []byte        `db:"ocsp_staple"`
	OcspExpiresAt sql.NullInt64 `db:"ocsp_expires_at"`
}

// FindCertificatesWithExpiringOCSP
//
//	SELECT pk, id, workspace_id, hostname, certificate, ocsp_staple, ocsp_expires_at
//	FROM certificates
//	WHERE ocsp_expires_at IS NULL OR ocsp_expires_at < ?
//	LIMIT 1000
func (q *Queries) FindCertificatesWithExpiringOCSP(ctx context.Context, db DBTX, ocspExpiresAt sql.NullInt64) ([]FindCertificatesWithExpiringOCSPRow, error) {
	rows, err := db.QueryContext(ctx, findCertificatesWithExpiringOCSP, ocspExpiresAt)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	var items []FindCertificatesWithExpiringOCSPRow
	for rows.Next() {
		var i FindCertificatesWithExpiringOCSPRow
		if err := rows.Scan(
			&i.Pk,
			&i.ID,
			&i.WorkspaceID,
			&i.Hostname,
			&i.Certificate,
			&i.OcspStaple,
			&i.OcspExpiresAt,
		); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Close(); err != nil {
		return nil, err
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}
