-- Code generated by Makefile. DO NOT EDIT.
--
-- Source: web/internal/db/src/schema
CREATE TABLE `apis` (
	`pk` bigint unsigned AUTO_INCREMENT NOT NULL,
	`id` varchar(256) NOT NULL,
	`name` varchar(256) NOT NULL,
	`workspace_id` varchar(256) NOT NULL,
	`ip_whitelist` varchar(512),
	`auth_type` enum('key','jwt'),
	`key_auth_id` varchar(256),
	`created_at_m` bigint NOT NULL DEFAULT 0,
	`updated_at_m` bigint,
	`deleted_at_m` bigint,
	`delete_protection` boolean DEFAULT false,
	CONSTRAINT `apis_pk` PRIMARY KEY(`pk`),
	CONSTRAINT `apis_id_unique` UNIQUE(`id`),
	CONSTRAINT `apis_key_auth_id_unique` UNIQUE(`key_auth_id`)
);

CREATE TABLE `keys_permissions` (
	`pk` bigint unsigned AUTO_INCREMENT NOT NULL,
	`temp_id` bigint,
	`key_id` varchar(256) NOT NULL,
	`permission_id` varchar(256) NOT NULL,
	`workspace_id` varchar(256) NOT NULL,
	`created_at_m` bigint NOT NULL DEFAULT 0,
	`updated_at_m` bigint,
	CONSTRAINT `keys_permissions_pk` PRIMARY KEY(`pk`),
	CONSTRAINT `keys_permissions_key_id_permission_id_workspace_id` UNIQUE(`key_id`,`permission_id`,`workspace_id`),
	CONSTRAINT `keys_permissions_temp_id_unique` UNIQUE(`temp_id`),
	CONSTRAINT `key_id_permission_id_idx` UNIQUE(`key_id`,`permission_id`)
);

CREATE TABLE `keys_roles` (
	`pk` bigint unsigned AUTO_INCREMENT NOT NULL,
	`key_id` varchar(256) NOT NULL,
	`role_id` varchar(256) NOT NULL,
	`workspace_id` varchar(256) NOT NULL,
	`created_at_m` bigint NOT NULL DEFAULT 0,
	`updated_at_m` bigint,
	CONSTRAINT `keys_roles_pk` PRIMARY KEY(`pk`),
	CONSTRAINT `keys_roles_role_id_key_id_workspace_id` UNIQUE(`role_id`,`key_id`,`workspace_id`),
	CONSTRAINT `unique_key_id_role_id` UNIQUE(`key_id`,`role_id`)
);

CREATE TABLE `permissions` (
	`pk` bigint unsigned AUTO_INCREMENT NOT NULL,
	`id` varchar(256) NOT NULL,
	`workspace_id` varchar(256) NOT NULL,
	`name` varchar(512) NOT NULL,
	`slug` varchar(128) NOT NULL,
	`description` varchar(512),
	`created_at_m` bigint NOT NULL DEFAULT 0,
	`updated_at_m` bigint,
	CONSTRAINT `permissions_pk` PRIMARY KEY(`pk`),
	CONSTRAINT `permissions_id_unique` UNIQUE(`id`),
	CONSTRAINT `unique_slug_per_workspace_idx` UNIQUE(`workspace_id`,`slug`)
);

CREATE TABLE `roles` (
	`pk` bigint unsigned AUTO_INCREMENT NOT NULL,
	`id` varchar(256) NOT NULL,
	`workspace_id` varchar(256) NOT NULL,
	`name` varchar(512) NOT NULL,
	`description` varchar(512),
	`created_at_m` bigint NOT NULL DEFAULT 0,
	`updated_at_m` bigint,
	CONSTRAINT `roles_pk` PRIMARY KEY(`pk`),
	CONSTRAINT `roles_id_unique` UNIQUE(`id`),
	CONSTRAINT `unique_name_per_workspace_idx` UNIQUE(`name`,`workspace_id`)
);

CREATE TABLE `roles_permissions` (
	`pk` bigint unsigned AUTO_INCREMENT NOT NULL,
	`role_id` varchar(256) NOT NULL,
	`permission_id` varchar(256) NOT NULL,
	`workspace_id` varchar(256) NOT NULL,
	`created_at_m` bigint NOT NULL DEFAULT 0,
	`updated_at_m` bigint,
	CONSTRAINT `roles_permissions_pk` PRIMARY KEY(`pk`),
	CONSTRAINT `roles_permissions_role_id_permission_id_workspace_id` UNIQUE(`role_id`,`permission_id`,`workspace_id`),
	CONSTRAINT `unique_tuple_permission_id_role_id` UNIQUE(`permission_id`,`role_id`)
);

CREATE TABLE `key_auth` (
	`pk` bigint unsigned AUTO_INCREMENT NOT NULL,
	`id` varchar(256) NOT NULL,
	`workspace_id` varchar(256) NOT NULL,
	`created_at_m` bigint NOT NULL DEFAULT 0,
	`updated_at_m` bigint,
	`deleted_at_m` bigint,
	`store_encrypted_keys` boolean NOT NULL DEFAULT false,
	`default_prefix` varchar(8),
	`default_bytes` int DEFAULT 16,
	`size_approx` int NOT NULL DEFAULT 0,
	`size_last_updated_at` bigint NOT NULL DEFAULT 0,
	CONSTRAINT `key_auth_pk` PRIMARY KEY(`pk`),
	CONSTRAINT `key_auth_id_unique` UNIQUE(`id`)
);

CREATE TABLE `encrypted_keys` (
	`pk` bigint unsigned AUTO_INCREMENT NOT NULL,
	`workspace_id` varchar(256) NOT NULL,
	`key_id` varchar(256) NOT NULL,
	`created_at` bigint NOT NULL DEFAULT 0,
	`updated_at` bigint,
	`encrypted` varchar(1024) NOT NULL,
	`encryption_key_id` varchar(256) NOT NULL,
	CONSTRAINT `encrypted_keys_pk` PRIMARY KEY(`pk`),
	CONSTRAINT `key_id_idx` UNIQUE(`key_id`)
);

CREATE TABLE `key_migrations` (
	`pk` bigint unsigned AUTO_INCREMENT NOT NULL,
	`id` varchar(256) NOT NULL,
	`workspace_id` varchar(256) NOT NULL,
	`algorithm` enum('sha256','github.com/seamapi/prefixed-api-key') NOT NULL,
	CONSTRAINT `key_migrations_pk` PRIMARY KEY(`pk`),
	CONSTRAINT `key_migrations_id_unique` UNIQUE(`id`),
	CONSTRAINT `unique_id_per_workspace_id` UNIQUE(`id`,`workspace_id`)
);

CREATE TABLE `keys` (
	`pk` bigint unsigned AUTO_INCREMENT NOT NULL,
	`id` varchar(256) NOT NULL,
	`key_auth_id` varchar(256) NOT NULL,
	`hash` varchar(256) NOT NULL,
	`start` varchar(256) NOT NULL,
	`workspace_id` varchar(256) NOT NULL,
	`for_workspace_id` varchar(256),
	`name` varchar(256),
	`owner_id` varchar(256),
	`identity_id` varchar(256),
	`meta` text,
	`expires` datetime(3),
	`created_at_m` bigint NOT NULL DEFAULT 0,
	`updated_at_m` bigint,
	`deleted_at_m` bigint,
	`refill_day` tinyint,
	`refill_amount` int,
	`last_refill_at` datetime(3),
	`enabled` boolean NOT NULL DEFAULT true,
	`remaining_requests` int,
	`ratelimit_async` boolean,
	`ratelimit_limit` int,
	`ratelimit_duration` bigint,
	`environment` varchar(256),
	`pending_migration_id` varchar(256),
	CONSTRAINT `keys_pk` PRIMARY KEY(`pk`),
	CONSTRAINT `keys_id_unique` UNIQUE(`id`),
	CONSTRAINT `hash_idx` UNIQUE(`hash`)
);

CREATE TABLE `vercel_bindings` (
	`pk` bigint unsigned AUTO_INCREMENT NOT NULL,
	`id` varchar(256) NOT NULL,
	`integration_id` varchar(256) NOT NULL,
	`workspace_id` varchar(256) NOT NULL,
	`project_id` varchar(256) NOT NULL,
	`environment` enum('development','preview','production') NOT NULL,
	`resource_id` varchar(256) NOT NULL,
	`resource_type` enum('rootKey','apiId') NOT NULL,
	`vercel_env_id` varchar(256) NOT NULL,
	`last_edited_by` varchar(256) NOT NULL,
	`created_at_m` bigint NOT NULL DEFAULT 0,
	`updated_at_m` bigint,
	`deleted_at_m` bigint,
	CONSTRAINT `vercel_bindings_pk` PRIMARY KEY(`pk`),
	CONSTRAINT `vercel_bindings_id_unique` UNIQUE(`id`),
	CONSTRAINT `project_environment_resource_type_idx` UNIQUE(`project_id`,`environment`,`resource_type`)
);

CREATE TABLE `vercel_integrations` (
	`pk` bigint unsigned AUTO_INCREMENT NOT NULL,
	`id` varchar(256) NOT NULL,
	`workspace_id` varchar(256) NOT NULL,
	`team_id` varchar(256),
	`access_token` varchar(256) NOT NULL,
	`created_at_m` bigint NOT NULL DEFAULT 0,
	`updated_at_m` bigint,
	`deleted_at_m` bigint,
	CONSTRAINT `vercel_integrations_pk` PRIMARY KEY(`pk`),
	CONSTRAINT `vercel_integrations_id_unique` UNIQUE(`id`)
);

CREATE TABLE `ratelimit_namespaces` (
	`pk` bigint unsigned AUTO_INCREMENT NOT NULL,
	`id` varchar(256) NOT NULL,
	`workspace_id` varchar(256) NOT NULL,
	`name` varchar(512) NOT NULL,
	`created_at_m` bigint NOT NULL DEFAULT 0,
	`updated_at_m` bigint,
	`deleted_at_m` bigint,
	CONSTRAINT `ratelimit_namespaces_pk` PRIMARY KEY(`pk`),
	CONSTRAINT `ratelimit_namespaces_id_unique` UNIQUE(`id`),
	CONSTRAINT `unique_name_per_workspace_idx` UNIQUE(`workspace_id`,`name`)
);

CREATE TABLE `ratelimit_overrides` (
	`pk` bigint unsigned AUTO_INCREMENT NOT NULL,
	`id` varchar(256) NOT NULL,
	`workspace_id` varchar(256) NOT NULL,
	`namespace_id` varchar(256) NOT NULL,
	`identifier` varchar(512) NOT NULL,
	`limit` int NOT NULL,
	`duration` int NOT NULL,
	`async` boolean,
	`sharding` enum('edge'),
	`created_at_m` bigint NOT NULL DEFAULT 0,
	`updated_at_m` bigint,
	`deleted_at_m` bigint,
	CONSTRAINT `ratelimit_overrides_pk` PRIMARY KEY(`pk`),
	CONSTRAINT `ratelimit_overrides_id_unique` UNIQUE(`id`),
	CONSTRAINT `unique_identifier_per_namespace_idx` UNIQUE(`namespace_id`,`identifier`)
);

CREATE TABLE `workspaces` (
	`pk` bigint unsigned AUTO_INCREMENT NOT NULL,
	`id` varchar(256) NOT NULL,
	`org_id` varchar(256) NOT NULL,
	`name` varchar(256) NOT NULL,
	`slug` varchar(64) NOT NULL,
	`k8s_namespace` varchar(256),
	`partition_id` varchar(256),
	`plan` enum('free','pro','enterprise') DEFAULT 'free',
	`tier` varchar(256) DEFAULT 'Free',
	`stripe_customer_id` varchar(256),
	`stripe_subscription_id` varchar(256),
	`beta_features` json NOT NULL,
	`features` json NOT NULL,
	`subscriptions` json,
	`enabled` boolean NOT NULL DEFAULT true,
	`delete_protection` boolean DEFAULT false,
	`created_at_m` bigint NOT NULL DEFAULT 0,
	`updated_at_m` bigint,
	`deleted_at_m` bigint,
	CONSTRAINT `workspaces_pk` PRIMARY KEY(`pk`),
	CONSTRAINT `workspaces_id_unique` UNIQUE(`id`),
	CONSTRAINT `workspaces_org_id_unique` UNIQUE(`org_id`),
	CONSTRAINT `workspaces_slug_unique` UNIQUE(`slug`),
	CONSTRAINT `workspaces_k8s_namespace_unique` UNIQUE(`k8s_namespace`)
);

CREATE TABLE `key_migration_errors` (
	`id` varchar(256) NOT NULL,
	`migration_id` varchar(256) NOT NULL,
	`created_at` bigint NOT NULL,
	`workspace_id` varchar(256) NOT NULL,
	`message` json NOT NULL,
	CONSTRAINT `key_migration_errors_id` PRIMARY KEY(`id`)
);

CREATE TABLE `identities` (
	`pk` bigint unsigned AUTO_INCREMENT NOT NULL,
	`id` varchar(256) NOT NULL,
	`external_id` varchar(256) NOT NULL,
	`workspace_id` varchar(256) NOT NULL,
	`environment` varchar(256) NOT NULL DEFAULT 'default',
	`meta` json,
	`deleted` boolean NOT NULL DEFAULT false,
	`created_at` bigint NOT NULL,
	`updated_at` bigint,
	CONSTRAINT `identities_pk` PRIMARY KEY(`pk`),
	CONSTRAINT `identities_id_unique` UNIQUE(`id`),
	CONSTRAINT `workspace_id_external_id_deleted_idx` UNIQUE(`workspace_id`,`external_id`,`deleted`)
);

CREATE TABLE `ratelimits` (
	`pk` bigint unsigned AUTO_INCREMENT NOT NULL,
	`id` varchar(256) NOT NULL,
	`name` varchar(256) NOT NULL,
	`workspace_id` varchar(256) NOT NULL,
	`created_at` bigint NOT NULL,
	`updated_at` bigint,
	`key_id` varchar(256),
	`identity_id` varchar(256),
	`limit` int NOT NULL,
	`duration` bigint NOT NULL,
	`auto_apply` boolean NOT NULL DEFAULT false,
	CONSTRAINT `ratelimits_pk` PRIMARY KEY(`pk`),
	CONSTRAINT `ratelimits_id_unique` UNIQUE(`id`),
	CONSTRAINT `unique_name_per_key_idx` UNIQUE(`key_id`,`name`),
	CONSTRAINT `unique_name_per_identity_idx` UNIQUE(`identity_id`,`name`)
);

CREATE TABLE `quota` (
	`pk` bigint unsigned AUTO_INCREMENT NOT NULL,
	`workspace_id` varchar(256) NOT NULL,
	`requests_per_month` bigint NOT NULL DEFAULT 0,
	`logs_retention_days` int NOT NULL DEFAULT 0,
	`audit_logs_retention_days` int NOT NULL DEFAULT 0,
	`team` boolean NOT NULL DEFAULT false,
	CONSTRAINT `quota_pk` PRIMARY KEY(`pk`),
	CONSTRAINT `quota_workspace_id_unique` UNIQUE(`workspace_id`)
);

CREATE TABLE `audit_log` (
	`pk` bigint unsigned AUTO_INCREMENT NOT NULL,
	`id` varchar(256) NOT NULL,
	`workspace_id` varchar(256) NOT NULL,
	`bucket` varchar(256) NOT NULL DEFAULT 'unkey_mutations',
	`bucket_id` varchar(256) NOT NULL,
	`event` varchar(256) NOT NULL,
	`time` bigint NOT NULL,
	`display` varchar(256) NOT NULL,
	`remote_ip` varchar(256),
	`user_agent` varchar(256),
	`actor_type` varchar(256) NOT NULL,
	`actor_id` varchar(256) NOT NULL,
	`actor_name` varchar(256),
	`actor_meta` json,
	`created_at` bigint NOT NULL,
	`updated_at` bigint,
	CONSTRAINT `audit_log_pk` PRIMARY KEY(`pk`),
	CONSTRAINT `audit_log_id_unique` UNIQUE(`id`)
);

CREATE TABLE `audit_log_bucket` (
	`pk` bigint unsigned AUTO_INCREMENT NOT NULL,
	`id` varchar(256) NOT NULL,
	`workspace_id` varchar(256) NOT NULL,
	`name` varchar(256) NOT NULL,
	`retention_days` int,
	`created_at` bigint NOT NULL,
	`updated_at` bigint,
	`delete_protection` boolean DEFAULT false,
	CONSTRAINT `audit_log_bucket_pk` PRIMARY KEY(`pk`),
	CONSTRAINT `audit_log_bucket_id_unique` UNIQUE(`id`),
	CONSTRAINT `unique_name_per_workspace_idx` UNIQUE(`workspace_id`,`name`)
);

CREATE TABLE `audit_log_target` (
	`pk` bigint unsigned AUTO_INCREMENT NOT NULL,
	`workspace_id` varchar(256) NOT NULL,
	`bucket_id` varchar(256) NOT NULL,
	`bucket` varchar(256) NOT NULL DEFAULT 'unkey_mutations',
	`audit_log_id` varchar(256) NOT NULL,
	`display_name` varchar(256) NOT NULL,
	`type` varchar(256) NOT NULL,
	`id` varchar(256) NOT NULL,
	`name` varchar(256),
	`meta` json,
	`created_at` bigint NOT NULL,
	`updated_at` bigint,
	CONSTRAINT `audit_log_target_pk` PRIMARY KEY(`pk`),
	CONSTRAINT `unique_id_per_log` UNIQUE(`audit_log_id`,`id`)
);

CREATE TABLE `environments` (
	`pk` bigint unsigned AUTO_INCREMENT NOT NULL,
	`id` varchar(128) NOT NULL,
	`workspace_id` varchar(256) NOT NULL,
	`project_id` varchar(256) NOT NULL,
	`slug` varchar(256) NOT NULL,
	`description` varchar(255) NOT NULL DEFAULT '',
	`sentinel_config` longblob NOT NULL,
	`delete_protection` boolean DEFAULT false,
	`created_at` bigint NOT NULL,
	`updated_at` bigint,
	CONSTRAINT `environments_pk` PRIMARY KEY(`pk`),
	CONSTRAINT `environments_id_unique` UNIQUE(`id`),
	CONSTRAINT `environments_project_id_slug_idx` UNIQUE(`project_id`,`slug`)
);

CREATE TABLE `environment_variables` (
	`pk` bigint unsigned AUTO_INCREMENT NOT NULL,
	`id` varchar(128) NOT NULL,
	`workspace_id` varchar(256) NOT NULL,
	`environment_id` varchar(128) NOT NULL,
	`key` varchar(256) NOT NULL,
	`value` varchar(4096) NOT NULL,
	`type` enum('recoverable','writeonly') NOT NULL,
	`description` varchar(255),
	`delete_protection` boolean DEFAULT false,
	`created_at` bigint NOT NULL,
	`updated_at` bigint,
	CONSTRAINT `environment_variables_pk` PRIMARY KEY(`pk`),
	CONSTRAINT `environment_variables_id_unique` UNIQUE(`id`),
	CONSTRAINT `environment_id_key` UNIQUE(`environment_id`,`key`)
);

CREATE TABLE `clickhouse_workspace_settings` (
	`pk` bigint unsigned AUTO_INCREMENT NOT NULL,
	`workspace_id` varchar(256) NOT NULL,
	`username` varchar(256) NOT NULL,
	`password_encrypted` text NOT NULL,
	`quota_duration_seconds` int NOT NULL DEFAULT 3600,
	`max_queries_per_window` int NOT NULL DEFAULT 1000,
	`max_execution_time_per_window` int NOT NULL DEFAULT 1800,
	`max_query_execution_time` int NOT NULL DEFAULT 30,
	`max_query_memory_bytes` bigint NOT NULL DEFAULT 1000000000,
	`max_query_result_rows` int NOT NULL DEFAULT 10000,
	`created_at` bigint NOT NULL DEFAULT 0,
	`updated_at` bigint,
	CONSTRAINT `clickhouse_workspace_settings_pk` PRIMARY KEY(`pk`),
	CONSTRAINT `clickhouse_workspace_settings_workspace_id_unique` UNIQUE(`workspace_id`),
	CONSTRAINT `clickhouse_workspace_settings_username_unique` UNIQUE(`username`)
);

CREATE TABLE `projects` (
	`pk` bigint unsigned AUTO_INCREMENT NOT NULL,
	`id` varchar(64) NOT NULL,
	`workspace_id` varchar(256) NOT NULL,
	`name` varchar(256) NOT NULL,
	`slug` varchar(256) NOT NULL,
	`git_repository_url` varchar(500),
	`live_deployment_id` varchar(256),
	`is_rolled_back` boolean NOT NULL DEFAULT false,
	`default_branch` varchar(256) DEFAULT 'main',
	`depot_project_id` varchar(255),
	`command` json NOT NULL DEFAULT ('[]'),
	`delete_protection` boolean DEFAULT false,
	`created_at` bigint NOT NULL,
	`updated_at` bigint,
	CONSTRAINT `projects_pk` PRIMARY KEY(`pk`),
	CONSTRAINT `projects_id_unique` UNIQUE(`id`),
	CONSTRAINT `workspace_slug_idx` UNIQUE(`workspace_id`,`slug`)
);

CREATE TABLE `deployments` (
	`pk` bigint unsigned AUTO_INCREMENT NOT NULL,
	`id` varchar(128) NOT NULL,
	`k8s_name` varchar(255) NOT NULL,
	`workspace_id` varchar(256) NOT NULL,
	`project_id` varchar(256) NOT NULL,
	`environment_id` varchar(128) NOT NULL,
	`image` varchar(256),
	`build_id` varchar(128),
	`git_commit_sha` varchar(40),
	`git_branch` varchar(256),
	`git_commit_message` text,
	`git_commit_author_handle` varchar(256),
	`git_commit_author_avatar_url` varchar(512),
	`git_commit_timestamp` bigint,
	`sentinel_config` longblob NOT NULL,
	`openapi_spec` longblob,
	`cpu_millicores` int NOT NULL,
	`memory_mib` int NOT NULL,
	`desired_state` enum('running','standby','archived') NOT NULL DEFAULT 'running',
	`encrypted_environment_variables` longblob NOT NULL,
	`command` json NOT NULL DEFAULT ('[]'),
	`status` enum('pending','building','deploying','network','ready','failed') NOT NULL DEFAULT 'pending',
	`created_at` bigint NOT NULL,
	`updated_at` bigint,
	CONSTRAINT `deployments_pk` PRIMARY KEY(`pk`),
	CONSTRAINT `deployments_id_unique` UNIQUE(`id`),
	CONSTRAINT `deployments_k8s_name_unique` UNIQUE(`k8s_name`),
	CONSTRAINT `deployments_build_id_unique` UNIQUE(`build_id`)
);

CREATE TABLE `deployment_topology` (
	`pk` bigint unsigned AUTO_INCREMENT NOT NULL,
	`workspace_id` varchar(64) NOT NULL,
	`deployment_id` varchar(64) NOT NULL,
	`region` varchar(64) NOT NULL,
	`desired_replicas` int NOT NULL,
	`version` bigint unsigned NOT NULL,
	`desired_status` enum('starting','started','stopping','stopped') NOT NULL,
	`created_at` bigint NOT NULL,
	`updated_at` bigint,
	CONSTRAINT `deployment_topology_pk` PRIMARY KEY(`pk`),
	CONSTRAINT `unique_region_per_deployment` UNIQUE(`deployment_id`,`region`),
	CONSTRAINT `unique_version_per_region` UNIQUE(`region`,`version`)
);

CREATE TABLE `acme_users` (
	`pk` bigint unsigned AUTO_INCREMENT NOT NULL,
	`id` varchar(128) NOT NULL,
	`workspace_id` varchar(255) NOT NULL,
	`encrypted_key` text NOT NULL,
	`registration_uri` text,
	`created_at` bigint NOT NULL,
	`updated_at` bigint,
	CONSTRAINT `acme_users_pk` PRIMARY KEY(`pk`),
	CONSTRAINT `acme_users_id_unique` UNIQUE(`id`)
);

CREATE TABLE `custom_domains` (
	`pk` bigint unsigned AUTO_INCREMENT NOT NULL,
	`id` varchar(128) NOT NULL,
	`workspace_id` varchar(256) NOT NULL,
	`project_id` varchar(256) NOT NULL,
	`environment_id` varchar(256) NOT NULL,
	`domain` varchar(256) NOT NULL,
	`challenge_type` enum('HTTP-01','DNS-01') NOT NULL,
	`verification_status` enum('pending','verifying','verified','failed') NOT NULL DEFAULT 'pending',
	`verification_token` varchar(64) NOT NULL,
	`ownership_verified` boolean NOT NULL DEFAULT false,
	`cname_verified` boolean NOT NULL DEFAULT false,
	`target_cname` varchar(256) NOT NULL,
	`last_checked_at` bigint,
	`check_attempts` int NOT NULL DEFAULT 0,
	`verification_error` varchar(512),
	`invocation_id` varchar(256),
	`created_at` bigint NOT NULL,
	`updated_at` bigint,
	CONSTRAINT `custom_domains_pk` PRIMARY KEY(`pk`),
	CONSTRAINT `custom_domains_id_unique` UNIQUE(`id`),
	CONSTRAINT `custom_domains_target_cname_unique` UNIQUE(`target_cname`),
	CONSTRAINT `unique_domain_idx` UNIQUE(`domain`)
);

CREATE TABLE `acme_challenges` (
	`pk` bigint unsigned AUTO_INCREMENT NOT NULL,
	`domain_id` varchar(255) NOT NULL,
	`workspace_id` varchar(255) NOT NULL,
	`token` varchar(255) NOT NULL,
	`challenge_type` enum('HTTP-01','DNS-01') NOT NULL,
	`authorization` varchar(255) NOT NULL,
	`status` enum('waiting','pending','verified','failed') NOT NULL,
	`expires_at` bigint NOT NULL,
	`created_at` bigint NOT NULL,
	`updated_at` bigint,
	CONSTRAINT `acme_challenges_pk` PRIMARY KEY(`pk`),
	CONSTRAINT `acme_challenges_domain_id_unique` UNIQUE(`domain_id`)
);

CREATE TABLE `sentinels` (
	`pk` bigint unsigned AUTO_INCREMENT NOT NULL,
	`id` varchar(64) NOT NULL,
	`workspace_id` varchar(255) NOT NULL,
	`project_id` varchar(255) NOT NULL,
	`environment_id` varchar(255) NOT NULL,
	`k8s_name` varchar(64) NOT NULL,
	`k8s_address` varchar(255) NOT NULL,
	`region` varchar(255) NOT NULL,
	`image` varchar(255) NOT NULL,
	`desired_state` enum('running','standby','archived') NOT NULL DEFAULT 'running',
	`health` enum('unknown','paused','healthy','unhealthy') NOT NULL DEFAULT 'unknown',
	`desired_replicas` int NOT NULL,
	`available_replicas` int NOT NULL,
	`cpu_millicores` int NOT NULL,
	`memory_mib` int NOT NULL,
	`version` bigint unsigned NOT NULL,
	`created_at` bigint NOT NULL,
	`updated_at` bigint,
	CONSTRAINT `sentinels_pk` PRIMARY KEY(`pk`),
	CONSTRAINT `sentinels_id_unique` UNIQUE(`id`),
	CONSTRAINT `sentinels_k8s_name_unique` UNIQUE(`k8s_name`),
	CONSTRAINT `sentinels_k8s_address_unique` UNIQUE(`k8s_address`),
	CONSTRAINT `one_env_per_region` UNIQUE(`environment_id`,`region`),
	CONSTRAINT `unique_version_per_region` UNIQUE(`region`,`version`)
);

CREATE TABLE `instances` (
	`pk` bigint unsigned AUTO_INCREMENT NOT NULL,
	`id` varchar(64) NOT NULL,
	`deployment_id` varchar(255) NOT NULL,
	`workspace_id` varchar(255) NOT NULL,
	`project_id` varchar(255) NOT NULL,
	`region` varchar(64) NOT NULL,
	`k8s_name` varchar(255) NOT NULL,
	`address` varchar(255) NOT NULL,
	`cpu_millicores` int NOT NULL,
	`memory_mib` int NOT NULL,
	`status` enum('inactive','pending','running','failed') NOT NULL,
	CONSTRAINT `instances_pk` PRIMARY KEY(`pk`),
	CONSTRAINT `instances_id_unique` UNIQUE(`id`),
	CONSTRAINT `unique_address_per_region` UNIQUE(`address`,`region`),
	CONSTRAINT `unique_k8s_name_per_region` UNIQUE(`k8s_name`,`region`)
);

CREATE TABLE `certificates` (
	`pk` bigint unsigned AUTO_INCREMENT NOT NULL,
	`id` varchar(64) NOT NULL,
	`workspace_id` varchar(255) NOT NULL,
	`hostname` varchar(255) NOT NULL,
	`certificate` text NOT NULL,
	`encrypted_private_key` text NOT NULL,
	`created_at` bigint NOT NULL,
	`updated_at` bigint,
	CONSTRAINT `certificates_pk` PRIMARY KEY(`pk`),
	CONSTRAINT `certificates_id_unique` UNIQUE(`id`),
	CONSTRAINT `unique_hostname` UNIQUE(`hostname`)
);

CREATE TABLE `frontline_routes` (
	`pk` bigint unsigned AUTO_INCREMENT NOT NULL,
	`id` varchar(128) NOT NULL,
	`project_id` varchar(255) NOT NULL,
	`deployment_id` varchar(255) NOT NULL,
	`environment_id` varchar(255) NOT NULL,
	`fully_qualified_domain_name` varchar(256) NOT NULL,
	`sticky` enum('none','branch','environment','live') NOT NULL DEFAULT 'none',
	`created_at` bigint NOT NULL,
	`updated_at` bigint,
	CONSTRAINT `frontline_routes_pk` PRIMARY KEY(`pk`),
	CONSTRAINT `frontline_routes_id_unique` UNIQUE(`id`),
	CONSTRAINT `frontline_routes_fully_qualified_domain_name_unique` UNIQUE(`fully_qualified_domain_name`)
);

CREATE TABLE `github_app_installations` (
	`pk` bigint unsigned AUTO_INCREMENT NOT NULL,
	`workspace_id` varchar(256) NOT NULL,
	`installation_id` bigint NOT NULL,
	`created_at` bigint NOT NULL,
	`updated_at` bigint,
	CONSTRAINT `github_app_installations_pk` PRIMARY KEY(`pk`),
	CONSTRAINT `github_app_installations_installation_id_unique` UNIQUE(`installation_id`)
);

CREATE TABLE `github_repo_connections` (
	`pk` bigint unsigned AUTO_INCREMENT NOT NULL,
	`project_id` varchar(64) NOT NULL,
	`installation_id` bigint NOT NULL,
	`repository_id` bigint NOT NULL,
	`repository_full_name` varchar(500) NOT NULL,
	`created_at` bigint NOT NULL,
	`updated_at` bigint,
	CONSTRAINT `github_repo_connections_pk` PRIMARY KEY(`pk`),
	CONSTRAINT `github_repo_connections_project_id_unique` UNIQUE(`project_id`)
);

CREATE INDEX `workspace_id_idx` ON `apis` (`workspace_id`);
CREATE INDEX `workspace_id_idx` ON `roles` (`workspace_id`);
CREATE INDEX `key_auth_id_deleted_at_idx` ON `keys` (`key_auth_id`,`deleted_at_m`);
CREATE INDEX `idx_keys_on_for_workspace_id` ON `keys` (`for_workspace_id`);
CREATE INDEX `pending_migration_id_idx` ON `keys` (`pending_migration_id`);
CREATE INDEX `idx_keys_on_workspace_id` ON `keys` (`workspace_id`);
CREATE INDEX `owner_id_idx` ON `keys` (`owner_id`);
CREATE INDEX `identity_id_idx` ON `keys` (`identity_id`);
CREATE INDEX `workspace_id_idx` ON `audit_log` (`workspace_id`);
CREATE INDEX `bucket_id_idx` ON `audit_log` (`bucket_id`);
CREATE INDEX `bucket_idx` ON `audit_log` (`bucket`);
CREATE INDEX `event_idx` ON `audit_log` (`event`);
CREATE INDEX `actor_id_idx` ON `audit_log` (`actor_id`);
CREATE INDEX `time_idx` ON `audit_log` (`time`);
CREATE INDEX `bucket` ON `audit_log_target` (`bucket`);
CREATE INDEX `id_idx` ON `audit_log_target` (`id`);
CREATE INDEX `workspace_idx` ON `deployments` (`workspace_id`);
CREATE INDEX `project_idx` ON `deployments` (`project_id`);
CREATE INDEX `status_idx` ON `deployments` (`status`);
CREATE INDEX `workspace_idx` ON `deployment_topology` (`workspace_id`);
CREATE INDEX `status_idx` ON `deployment_topology` (`desired_status`);
CREATE INDEX `domain_idx` ON `acme_users` (`workspace_id`);
CREATE INDEX `workspace_idx` ON `custom_domains` (`workspace_id`);
CREATE INDEX `project_idx` ON `custom_domains` (`project_id`);
CREATE INDEX `verification_status_idx` ON `custom_domains` (`verification_status`);
CREATE INDEX `workspace_idx` ON `acme_challenges` (`workspace_id`);
CREATE INDEX `status_idx` ON `acme_challenges` (`status`);
CREATE INDEX `idx_environment_id` ON `sentinels` (`environment_id`);
CREATE INDEX `idx_deployment_id` ON `instances` (`deployment_id`);
CREATE INDEX `idx_region` ON `instances` (`region`);
CREATE INDEX `environment_id_idx` ON `frontline_routes` (`environment_id`);
CREATE INDEX `deployment_id_idx` ON `frontline_routes` (`deployment_id`);

