// Code generated by sqlc. DO NOT EDIT.
// versions:
//   sqlc v1.30.0
// source: identity_upsert.sql

package db

import (
	"context"
	"encoding/json"
)

const upsertIdentity = `-- name: UpsertIdentity :exec
INSERT INTO ` + "`" + `identities` + "`" + ` (
    id,
    external_id,
    workspace_id,
    environment,
    created_at,
    meta
) VALUES (
    ?,
    ?,
    ?,
    ?,
    ?,
    CAST(? AS JSON)
)
ON DUPLICATE KEY UPDATE external_id = external_id
`

type UpsertIdentityParams struct {
	ID          string          `db:"id"`
	ExternalID  string          `db:"external_id"`
	WorkspaceID string          `db:"workspace_id"`
	Environment string          `db:"environment"`
	CreatedAt   int64           `db:"created_at"`
	Meta        json.RawMessage `db:"meta"`
}

// Inserts a new identity or does nothing if one already exists for this workspace/external_id.
// Use FindIdentityByExternalID after this to get the actual ID.
//
//	INSERT INTO `identities` (
//	    id,
//	    external_id,
//	    workspace_id,
//	    environment,
//	    created_at,
//	    meta
//	) VALUES (
//	    ?,
//	    ?,
//	    ?,
//	    ?,
//	    ?,
//	    CAST(? AS JSON)
//	)
//	ON DUPLICATE KEY UPDATE external_id = external_id
func (q *Queries) UpsertIdentity(ctx context.Context, db DBTX, arg UpsertIdentityParams) error {
	_, err := db.ExecContext(ctx, upsertIdentity,
		arg.ID,
		arg.ExternalID,
		arg.WorkspaceID,
		arg.Environment,
		arg.CreatedAt,
		arg.Meta,
	)
	return err
}
