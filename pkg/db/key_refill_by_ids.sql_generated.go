// Code generated by sqlc. DO NOT EDIT.
// versions:
//   sqlc v1.30.0
// source: key_refill_by_ids.sql

package db

import (
	"context"
	"database/sql"
	"strings"
)

const refillKeysByIDs = `-- name: RefillKeysByIDs :exec
UPDATE ` + "`" + `keys` + "`" + `
SET remaining_requests = refill_amount,
    last_refill_at = NOW(3),
    updated_at_m = ?
WHERE id IN (/*SLICE:ids*/?)
  AND deleted_at_m IS NULL
`

type RefillKeysByIDsParams struct {
	Now sql.NullInt64 `db:"now"`
	Ids []string      `db:"ids"`
}

// RefillKeysByIDs sets remaining_requests to refill_amount for the given keys.
// This is a bulk operation to minimize database round trips.
//
//	UPDATE `keys`
//	SET remaining_requests = refill_amount,
//	    last_refill_at = NOW(3),
//	    updated_at_m = ?
//	WHERE id IN (/*SLICE:ids*/?)
//	  AND deleted_at_m IS NULL
func (q *Queries) RefillKeysByIDs(ctx context.Context, db DBTX, arg RefillKeysByIDsParams) error {
	query := refillKeysByIDs
	var queryParams []interface{}
	queryParams = append(queryParams, arg.Now)
	if len(arg.Ids) > 0 {
		for _, v := range arg.Ids {
			queryParams = append(queryParams, v)
		}
		query = strings.Replace(query, "/*SLICE:ids*/?", strings.Repeat(",?", len(arg.Ids))[1:], 1)
	} else {
		query = strings.Replace(query, "/*SLICE:ids*/?", "NULL", 1)
	}
	_, err := db.ExecContext(ctx, query, queryParams...)
	return err
}
