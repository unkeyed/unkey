// Code generated by sqlc. DO NOT EDIT.
// versions:
//   sqlc v1.30.0
// source: workspace_list_all.sql

package db

import (
	"context"
)

const listWorkspacesWithQuotas = `-- name: ListWorkspacesWithQuotas :many
SELECT
   w.id, w.org_id, w.name, w.slug, w.k8s_namespace, w.partition_id, w.plan, w.tier, w.stripe_customer_id, w.stripe_subscription_id, w.beta_features, w.features, w.subscriptions, w.enabled, w.delete_protection, w.created_at_m, w.updated_at_m, w.deleted_at_m,
   q.pk, q.workspace_id, q.requests_per_month, q.logs_retention_days, q.audit_logs_retention_days, q.team
FROM ` + "`" + `workspaces` + "`" + ` w
LEFT JOIN quota q ON w.id = q.workspace_id
WHERE w.enabled = true
ORDER BY w.id ASC
`

type ListWorkspacesWithQuotasRow struct {
	Workspace Workspace `db:"workspace"`
	Quotas    Quotum    `db:"quotum"`
}

// ListWorkspacesWithQuotas returns all enabled workspaces with their quota settings.
// Used for bulk quota checking operations.
//
//	SELECT
//	   w.id, w.org_id, w.name, w.slug, w.k8s_namespace, w.partition_id, w.plan, w.tier, w.stripe_customer_id, w.stripe_subscription_id, w.beta_features, w.features, w.subscriptions, w.enabled, w.delete_protection, w.created_at_m, w.updated_at_m, w.deleted_at_m,
//	   q.pk, q.workspace_id, q.requests_per_month, q.logs_retention_days, q.audit_logs_retention_days, q.team
//	FROM `workspaces` w
//	LEFT JOIN quota q ON w.id = q.workspace_id
//	WHERE w.enabled = true
//	ORDER BY w.id ASC
func (q *Queries) ListWorkspacesWithQuotas(ctx context.Context, db DBTX) ([]ListWorkspacesWithQuotasRow, error) {
	rows, err := db.QueryContext(ctx, listWorkspacesWithQuotas)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	var items []ListWorkspacesWithQuotasRow
	for rows.Next() {
		var i ListWorkspacesWithQuotasRow
		if err := rows.Scan(
			&i.Workspace.ID,
			&i.Workspace.OrgID,
			&i.Workspace.Name,
			&i.Workspace.Slug,
			&i.Workspace.K8sNamespace,
			&i.Workspace.PartitionID,
			&i.Workspace.Plan,
			&i.Workspace.Tier,
			&i.Workspace.StripeCustomerID,
			&i.Workspace.StripeSubscriptionID,
			&i.Workspace.BetaFeatures,
			&i.Workspace.Features,
			&i.Workspace.Subscriptions,
			&i.Workspace.Enabled,
			&i.Workspace.DeleteProtection,
			&i.Workspace.CreatedAtM,
			&i.Workspace.UpdatedAtM,
			&i.Workspace.DeletedAtM,
			&i.Quotas.Pk,
			&i.Quotas.WorkspaceID,
			&i.Quotas.RequestsPerMonth,
			&i.Quotas.LogsRetentionDays,
			&i.Quotas.AuditLogsRetentionDays,
			&i.Quotas.Team,
		); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Close(); err != nil {
		return nil, err
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}
