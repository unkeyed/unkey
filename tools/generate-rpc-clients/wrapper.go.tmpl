// Code generated by generate-rpc-clients. DO NOT EDIT.

package {{ .PackageName }}

import (
	"context"

	"connectrpc.com/connect"
	{{ .ProtoAlias }} "{{ .ProtoImport }}"
	"{{ .ConnectImport }}"
	"github.com/unkeyed/unkey/pkg/otel/tracing"
)
{{ range $svc := .Services }}
// {{ $svc.Name }} wraps {{ $.ConnectPkg }}.{{ $svc.Name }} with simplified signatures.
// Request and response types are plain protobuf messages without connect wrappers.
type {{ $svc.Name }} interface {
{{- range $svc.Methods }}
{{- if eq .Kind "server_stream" }}
	{{ .Name }}(ctx context.Context, req *{{ $.ProtoAlias }}.{{ .ReqType }}) (*connect.ServerStreamForClient[{{ $.ProtoAlias }}.{{ .RespType }}], error)
{{- else }}
	{{ .Name }}(ctx context.Context, req *{{ $.ProtoAlias }}.{{ .ReqType }}) (*{{ $.ProtoAlias }}.{{ .RespType }}, error)
{{- end }}
{{- end }}
}

var _ {{ $svc.Name }} = (*Connect{{ $svc.Name }})(nil)

// Connect{{ $svc.Name }} adapts a {{ $.ConnectPkg }}.{{ $svc.Name }} to the simplified {{ $svc.Name }} interface.
type Connect{{ $svc.Name }} struct {
	inner {{ $.ConnectPkg }}.{{ $svc.Name }}
}

// NewConnect{{ $svc.Name }} creates a new Connect{{ $svc.Name }}.
func NewConnect{{ $svc.Name }}(inner {{ $.ConnectPkg }}.{{ $svc.Name }}) *Connect{{ $svc.Name }} {
	return &Connect{{ $svc.Name }}{inner: inner}
}
{{ range $svc.Methods }}
{{- if eq .Kind "server_stream" }}
func (c *Connect{{ $svc.Name }}) {{ .Name }}(ctx context.Context, req *{{ $.ProtoAlias }}.{{ .ReqType }}) (*connect.ServerStreamForClient[{{ $.ProtoAlias }}.{{ .RespType }}], error) {
	return c.inner.{{ .Name }}(ctx, connect.NewRequest(req))
}
{{ else }}
func (c *Connect{{ $svc.Name }}) {{ .Name }}(ctx context.Context, req *{{ $.ProtoAlias }}.{{ .ReqType }}) (*{{ $.ProtoAlias }}.{{ .RespType }}, error) {
	ctx, span := tracing.Start(ctx, "{{ $svc.ServiceBaseName }}.{{ .Name }}")
	defer span.End()
	resp, err := c.inner.{{ .Name }}(ctx, connect.NewRequest(req))
	if err != nil {
		if connect.CodeOf(err) != connect.CodeNotFound {
			tracing.RecordError(span, err)
		}
		return nil, err
	}
	return resp.Msg, nil
}
{{ end }}
{{- end -}}
{{- end -}}
