global:
  scrape_interval: 15s
  # Enable legacy metric name validation if needed for compatibility
  metric_name_validation_scheme: legacy

scrape_configs:
  - job_name: "prometheus"
    # Explicitly specify scrape protocol fallback for compatibility
    scrape_protocols:
      - "OpenMetricsText1.0.0"
      - "OpenMetricsText0.0.1"
      - "PrometheusText0.0.4"

    # Enable HTTP/2 for scraping if supported
    http_config:
      enable_http2: true

    http_sd_configs:
      - url: http://apiv2:2112/sd
        refresh_interval: "60s"
        follow_redirects: true
