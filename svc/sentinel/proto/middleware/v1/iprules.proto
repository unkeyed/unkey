syntax = "proto3";

package sentinel.v1;

option go_package = "github.com/unkeyed/unkey/gen/proto/sentinel/v1;sentinelv1";

// IPRules allows or denies requests based on the client's IP address,
// evaluated against CIDR ranges.
//
// IP-based access control is a fundamental security layer, especially for
// APIs that should only be accessible from known networks (corporate VPNs,
// cloud provider IP ranges, partner infrastructure) or that need to block
// traffic from known-bad sources. This is an adoption blocker for customers
// in regulated industries where network-level access control is a compliance
// requirement.
//
// When both allow and deny lists are configured, deny is evaluated first.
// If the client IP matches a deny CIDR, the request is rejected immediately
// regardless of the allow list. If the allow list is non-empty and the
// client IP does not match any allow CIDR, the request is also rejected.
// This "deny-first" approach ensures that explicitly blocked addresses
// cannot bypass the block by also appearing in an allow range.
//
// When sentinel is behind a load balancer or CDN, it uses the
// X-Forwarded-For header to determine the client IP. The rightmost
// untrusted entry in the chain is used to prevent spoofing.
message IPRules {
  // Allowed CIDR ranges. When non-empty, the policy operates in allowlist
  // mode: only client IPs matching at least one of these CIDRs are
  // permitted. Use /32 for individual IPv4 addresses and /128 for
  // individual IPv6 addresses.
  //
  // Examples: ["10.0.0.0/8", "192.168.1.0/24", "203.0.113.42/32"]
  repeated string allow = 1;

  // Denied CIDR ranges. Client IPs matching any of these CIDRs are
  // rejected, even if they also match an allow entry. The deny list is
  // always evaluated before the allow list.
  repeated string deny = 2;
}
