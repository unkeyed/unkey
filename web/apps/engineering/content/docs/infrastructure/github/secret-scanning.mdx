---
title: Secret Scanning
description: GitHub Secret Scanning Partnership for leaked key detection
---

Unkey participates in GitHub's Secret Scanning Partner Program. When Unkey API keys are accidentally committed to public repositories, GitHub automatically notifies us so we can alert the key owner.

## How It Works

```
┌─────────────┐     ┌─────────────┐     ┌─────────────┐
│   GitHub    │────►│  Dashboard  │────►│  Database   │
│   Webhook   │     │  /api/v1/   │     │  (lookup)   │
│             │     │  github/    │     │             │
│             │     │  verify     │     │             │
└─────────────┘     └─────────────┘     └─────────────┘
                           │
                           ▼
                    ┌─────────────┐     ┌─────────────┐
                    │   Resend    │     │   Slack     │
                    │   (email)   │     │   (alert)   │
                    └─────────────┘     └─────────────┘
```

1. A user accidentally commits an Unkey API key to a public GitHub repository
2. GitHub's secret scanning detects the key pattern
3. GitHub sends a webhook to our `/api/v1/github/verify` endpoint
4. We verify the webhook signature using GitHub's public keys
5. We hash the token and check if it exists in our database
6. If found, we:
   - Email all workspace members via Resend
   - Post an alert to our internal Slack channel
7. We respond to GitHub indicating whether it was a true or false positive

## Environment Variables

| Variable | Description |
|----------|-------------|
| `GITHUB_KEYS_URI` | URL to fetch GitHub's public keys for signature verification |
| `RESEND_API_KEY` | API key for sending notification emails |
| `SLACK_WEBHOOK_URL_LEAKED_KEY` | Slack webhook for internal alerts |

## Webhook Verification

GitHub signs all secret scanning webhooks. We verify the signature using GitHub's public keys:

```typescript
const verifyGitSignature = async (
  payload: string,
  signature: string,
  keyId: string,
  githubKeysUri: string,
) => {
  const gitHub = await fetch(githubKeysUri);
  const gitBody = await gitHub.json();
  const publicKey = gitBody.public_keys.find(k => k.key_identifier === keyId);
  
  const verify = crypto.createVerify("SHA256").update(payload);
  return verify.verify(publicKey.key, Buffer.from(signature, "base64"));
};
```

## Response Format

GitHub expects a specific response format:

```typescript
// True positive - we found this key in our database
{
  token_raw: "the_actual_token",
  token_type: "unkey_api_key",
  label: "true_positive"
}

// False positive - key not found (possibly already deleted/rotated)
{
  token_hash: "sha256_hash_of_token",
  token_type: "unkey_api_key", 
  label: "false_positive"
}
```

## Notifications

When a leaked key is detected:

### Email (via Resend)
All workspace members receive an email with:
- Date of detection
- Source (where the key was found)
- URL to the commit/file

### Slack Alert
Internal Slack channel receives:
- Key ID
- Workspace name
- Organization ID
- Source and URL
- User contact email

## GitHub Partner Program

To participate in GitHub's Secret Scanning Partner Program:

1. Define a regex pattern that matches your secret format
2. Provide a webhook endpoint for GitHub to notify
3. Implement signature verification
4. Respond with true/false positive labels

See [GitHub's documentation](https://docs.github.com/en/code-security/secret-scanning/secret-scanning-partnership-program/secret-scanning-partner-program) for more details.
