VERSION 1
NODE aggregate


SQL >

    SELECT
        workspaceId,
        apiId,
        keyId,
        countIfState((deniedReason = '') OR (deniedReason IS NULL)) AS success,
        countIfState(deniedReason = 'RATE_LIMITED') AS rateLimited,
        countIfState(deniedReason = 'USAGE_EXCEEDED') AS usageExceeded
    FROM key_verifications__v2
    GROUP BY workspaceId, apiId, keyId, time

TYPE materialized
DATASOURCE mv__monthly_verifications__v1
