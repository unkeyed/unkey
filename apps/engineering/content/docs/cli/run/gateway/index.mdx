---
title: "Ingressway"
description: "Run the Unkey Ingressway server (per-tenant ingressway)"
---

## Command Syntax

```bash
unkey run ingressway [flags]
```

<Banner type="warn">
Some flags are required for this command to work properly.
</Banner>

## Flags

<Callout type="info" title="--http-port">
HTTP port for the Ingressway server to listen on. Default: 8080

- **Type:** integer
- **Default:** `8080`
- **Environment:** `UNKEY_HTTP_PORT`
</Callout>

<Callout type="info" title="--https-port">
HTTPS port for the Ingressway server to listen on. Default: 8443

- **Type:** integer
- **Default:** `8443`
- **Environment:** `UNKEY_HTTPS_PORT`
</Callout>

<Callout type="info" title="--tls-enabled">
Enable TLS for the ingressway. Default: false (uses mTLS via SPIRE)

- **Type:** boolean
- **Default:** `false`
- **Environment:** `UNKEY_TLS_ENABLED`
</Callout>

<Callout type="info" title="--platform">
Cloud platform identifier for this node. Used for logging and metrics.

- **Type:** string
- **Environment:** `UNKEY_PLATFORM`
</Callout>

<Callout type="info" title="--image">
Container image identifier. Used for logging and metrics.

- **Type:** string
- **Environment:** `UNKEY_IMAGE`
</Callout>

<Callout type="info" title="--region">
Geographic region identifier. Used for logging and routing. Default: unknown

- **Type:** string
- **Default:** `"unknown"`
- **Environment:** `UNKEY_REGION`, `AWS_REGION`
</Callout>

<Callout type="info" title="--ingressway-id">
Unique identifier for this instance. Auto-generated if not provided.

- **Type:** string
- **Default:** `"ingressway_XyZ1"`
- **Environment:** `UNKEY_PORTAL_ID`
</Callout>

<Callout type="info" title="--deployment-id (required)">
Deployment ID this ingressway belongs to (e.g., d-abc123). Required.

- **Type:** string
- **Environment:** `UNKEY_DEPLOYMENT_ID`
</Callout>

<Callout type="info" title="--workspace-id (required)">
Workspace ID this ingressway belongs to. Required.

- **Type:** string
- **Environment:** `UNKEY_WORKSPACE_ID`
</Callout>

<Callout type="info" title="--ctrl-addr">
Address for the control plane to connect to

- **Type:** string
- **Environment:** `UNKEY_CTRL_ADDR`
</Callout>

<Callout type="info" title="--database-primary (required)">
MySQL connection string for partitioned primary database (ingressway operations). Required. Example: user:pass@host:3306/partition_001?parseTime=true

- **Type:** string
- **Environment:** `UNKEY_DATABASE_PRIMARY`
</Callout>

<Callout type="info" title="--database-replica">
MySQL connection string for partitioned read-replica (ingressway operations). Format same as database-primary.

- **Type:** string
- **Environment:** `UNKEY_DATABASE_REPLICA`
</Callout>

<Callout type="info" title="--main-database-primary (required)">
MySQL connection string for keys service primary database (non-partitioned). Required. Example: user:pass@host:3306/unkey?parseTime=true

- **Type:** string
- **Environment:** `UNKEY_KEYS_DATABASE_PRIMARY`
</Callout>

<Callout type="info" title="--main-database-replica">
MySQL connection string for keys service read-replica (non-partitioned). Format same as main-database-primary.

- **Type:** string
- **Environment:** `UNKEY_KEYS_DATABASE_REPLICA`
</Callout>

<Callout type="info" title="--clickhouse-url">
ClickHouse connection string for analytics. Recommended for production. Example: clickhouse://user:pass@host:9000/unkey

- **Type:** string
- **Environment:** `UNKEY_CLICKHOUSE_URL`
</Callout>

<Callout type="info" title="--redis-url">
Redis connection string for caching. Recommended for production. Example: redis://user:pass@host:6379/0

- **Type:** string
- **Environment:** `UNKEY_REDIS_URL`
</Callout>

<Callout type="info" title="--spire-enabled">
Enable SPIRE-based mTLS for ingress communication. Default: false

- **Type:** boolean
- **Default:** `false`
- **Environment:** `UNKEY_SPIRE_ENABLED`
</Callout>

<Callout type="info" title="--spire-socket-path">
Path to SPIRE agent socket. Default: /run/spire/sockets/agent.sock

- **Type:** string
- **Default:** `"/run/spire/sockets/agent.sock"`
- **Environment:** `UNKEY_SPIRE_SOCKET_PATH`
</Callout>

<Callout type="info" title="--otel">
Enable OpenTelemetry tracing and metrics

- **Type:** boolean
- **Default:** `false`
- **Environment:** `UNKEY_OTEL`
</Callout>

<Callout type="info" title="--otel-trace-sampling-rate">
Sampling rate for OpenTelemetry traces (0.0-1.0). Only used when --otel is provided. Default: 0.25

- **Type:** float
- **Default:** `0.25`
- **Environment:** `UNKEY_OTEL_TRACE_SAMPLING_RATE`
</Callout>

<Callout type="info" title="--prometheus-port">
Enable Prometheus /metrics endpoint on specified port. Set to 0 to disable.

- **Type:** integer
- **Default:** `0`
- **Environment:** `UNKEY_PROMETHEUS_PORT`
</Callout>

<Callout type="info" title="--vault-master-keys">
Vault master keys for encryption

- **Type:** string[]
- **Environment:** `UNKEY_VAULT_MASTER_KEYS`
</Callout>

<Callout type="info" title="--vault-s3-url">
S3 Compatible Endpoint URL

- **Type:** string
- **Environment:** `UNKEY_VAULT_S3_URL`
</Callout>

<Callout type="info" title="--vault-s3-bucket">
S3 bucket name

- **Type:** string
- **Environment:** `UNKEY_VAULT_S3_BUCKET`
</Callout>

<Callout type="info" title="--vault-s3-access-key-id">
S3 access key ID

- **Type:** string
- **Environment:** `UNKEY_VAULT_S3_ACCESS_KEY_ID`
</Callout>

<Callout type="info" title="--vault-s3-access-key-secret">
S3 secret access key

- **Type:** string
- **Environment:** `UNKEY_VAULT_S3_ACCESS_KEY_SECRET`
</Callout>

## Example Usage

### Production Deployment (via Krane)

Typically Ingressway is deployed via Krane, not manually:

```yaml
# Krane creates Ingressway with these env vars
env:
  - name: UNKEY_DEPLOYMENT_ID
    value: "d-abc123"
  - name: UNKEY_WORKSPACE_ID
    value: "ws-xyz"
  - name: UNKEY_REGION
    value: "us-east-1"
  - name: UNKEY_DATABASE_PRIMARY
    valueFrom:
      secretKeyRef:
        name: partition-db-creds
        key: primary-dsn
  - name: UNKEY_KEYS_DATABASE_PRIMARY
    valueFrom:
      secretKeyRef:
        name: main-db-creds
        key: primary-dsn
  - name: UNKEY_SPIRE_ENABLED
    value: "true"
```

### Manual Testing

```bash
unkey run ingressway \
  --deployment-id=d-test123 \
  --workspace-id=ws-test \
  --region=us-east-1 \
  --database-primary="user:pass@db:3306/partition_001?parseTime=true" \
  --main-database-primary="user:pass@db:3306/unkey?parseTime=true" \
  --redis-url="redis://localhost:6379/0" \
  --spire-enabled=true \
  --otel=true \
  --prometheus-port=9090
```

### Local Development

```bash
unkey run ingressway \
  --deployment-id=d-local \
  --workspace-id=ws-local \
  --region=local \
  --database-primary="root@localhost:3306/partition_001?parseTime=true" \
  --main-database-primary="root@localhost:3306/unkey?parseTime=true"
```

## Notes

- Ingressway instances are typically managed by Krane, not run manually
- Each deployment gets its own isolated Ingressway instance
- SPIRE is recommended for production mTLS
- Ingressway requires both partition DB (for config) and main DB (for keys)
