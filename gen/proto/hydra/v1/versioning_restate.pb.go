// Code generated by protoc-gen-go-restate. DO NOT EDIT.
// versions:
// - protoc-gen-go-restate v0.1
// - protoc             (unknown)
// source: hydra/v1/versioning.proto

package hydrav1

import (
	fmt "fmt"
	sdk_go "github.com/restatedev/sdk-go"
	encoding "github.com/restatedev/sdk-go/encoding"
	ingress "github.com/restatedev/sdk-go/ingress"
)

// VersioningServiceClient is the client API for hydra.v1.VersioningService service.
//
// VersioningService provides globally unique, monotonically increasing versions
// for state synchronization between the control plane and edge agents.
//
// This is a singleton virtual object (use empty string as key). The version is
// used to track state changes in deployments and sentinels tables, enabling
// efficient incremental synchronization.
//
// Usage:
//  1. Before mutating a deployment or sentinel, call NextVersion to get a new version
//  2. Update the resource row with this version
//  3. Edge agents track their last-seen version and request changes after it
//  4. Sync queries filter by region: WHERE region = ? AND version > ?
type VersioningServiceClient interface {
	// NextVersion atomically increments and returns the next version number.
	//
	// The version is durably stored in Restate's virtual object state, guaranteeing:
	//   - Monotonically increasing values (no gaps under normal operation)
	//   - Exactly-once semantics (retries return the same version)
	//   - Single-writer (singleton virtual object)
	NextVersion(opts ...sdk_go.ClientOption) sdk_go.Client[*NextVersionRequest, *NextVersionResponse]
	// GetVersion returns the current version without incrementing.
	// Useful for stale cursor detection: if client's version < min retained, force bootstrap.
	GetVersion(opts ...sdk_go.ClientOption) sdk_go.Client[*GetVersionRequest, *GetVersionResponse]
}

type versioningServiceClient struct {
	ctx     sdk_go.Context
	key     string
	options []sdk_go.ClientOption
}

func NewVersioningServiceClient(ctx sdk_go.Context, key string, opts ...sdk_go.ClientOption) VersioningServiceClient {
	cOpts := append([]sdk_go.ClientOption{sdk_go.WithProtoJSON}, opts...)
	return &versioningServiceClient{
		ctx,
		key,
		cOpts,
	}
}
func (c *versioningServiceClient) NextVersion(opts ...sdk_go.ClientOption) sdk_go.Client[*NextVersionRequest, *NextVersionResponse] {
	cOpts := c.options
	if len(opts) > 0 {
		cOpts = append(append([]sdk_go.ClientOption{}, cOpts...), opts...)
	}
	return sdk_go.WithRequestType[*NextVersionRequest](sdk_go.Object[*NextVersionResponse](c.ctx, "hydra.v1.VersioningService", c.key, "NextVersion", cOpts...))
}

func (c *versioningServiceClient) GetVersion(opts ...sdk_go.ClientOption) sdk_go.Client[*GetVersionRequest, *GetVersionResponse] {
	cOpts := c.options
	if len(opts) > 0 {
		cOpts = append(append([]sdk_go.ClientOption{}, cOpts...), opts...)
	}
	return sdk_go.WithRequestType[*GetVersionRequest](sdk_go.Object[*GetVersionResponse](c.ctx, "hydra.v1.VersioningService", c.key, "GetVersion", cOpts...))
}

// VersioningServiceIngressClient is the ingress client API for hydra.v1.VersioningService service.
//
// This client is used to call the service from outside of a Restate context.
type VersioningServiceIngressClient interface {
	// NextVersion atomically increments and returns the next version number.
	//
	// The version is durably stored in Restate's virtual object state, guaranteeing:
	//   - Monotonically increasing values (no gaps under normal operation)
	//   - Exactly-once semantics (retries return the same version)
	//   - Single-writer (singleton virtual object)
	NextVersion() ingress.Requester[*NextVersionRequest, *NextVersionResponse]
	// GetVersion returns the current version without incrementing.
	// Useful for stale cursor detection: if client's version < min retained, force bootstrap.
	GetVersion() ingress.Requester[*GetVersionRequest, *GetVersionResponse]
}

type versioningServiceIngressClient struct {
	client      *ingress.Client
	serviceName string
	key         string
}

func NewVersioningServiceIngressClient(client *ingress.Client, key string) VersioningServiceIngressClient {
	return &versioningServiceIngressClient{
		client,
		"hydra.v1.VersioningService",
		key,
	}
}

func (c *versioningServiceIngressClient) NextVersion() ingress.Requester[*NextVersionRequest, *NextVersionResponse] {
	codec := encoding.ProtoJSONCodec
	return ingress.NewRequester[*NextVersionRequest, *NextVersionResponse](c.client, c.serviceName, "NextVersion", &c.key, &codec)
}

func (c *versioningServiceIngressClient) GetVersion() ingress.Requester[*GetVersionRequest, *GetVersionResponse] {
	codec := encoding.ProtoJSONCodec
	return ingress.NewRequester[*GetVersionRequest, *GetVersionResponse](c.client, c.serviceName, "GetVersion", &c.key, &codec)
}

// VersioningServiceServer is the server API for hydra.v1.VersioningService service.
// All implementations should embed UnimplementedVersioningServiceServer
// for forward compatibility.
//
// VersioningService provides globally unique, monotonically increasing versions
// for state synchronization between the control plane and edge agents.
//
// This is a singleton virtual object (use empty string as key). The version is
// used to track state changes in deployments and sentinels tables, enabling
// efficient incremental synchronization.
//
// Usage:
//  1. Before mutating a deployment or sentinel, call NextVersion to get a new version
//  2. Update the resource row with this version
//  3. Edge agents track their last-seen version and request changes after it
//  4. Sync queries filter by region: WHERE region = ? AND version > ?
type VersioningServiceServer interface {
	// NextVersion atomically increments and returns the next version number.
	//
	// The version is durably stored in Restate's virtual object state, guaranteeing:
	//   - Monotonically increasing values (no gaps under normal operation)
	//   - Exactly-once semantics (retries return the same version)
	//   - Single-writer (singleton virtual object)
	NextVersion(ctx sdk_go.ObjectContext, req *NextVersionRequest) (*NextVersionResponse, error)
	// GetVersion returns the current version without incrementing.
	// Useful for stale cursor detection: if client's version < min retained, force bootstrap.
	GetVersion(ctx sdk_go.ObjectContext, req *GetVersionRequest) (*GetVersionResponse, error)
}

// UnimplementedVersioningServiceServer should be embedded to have
// forward compatible implementations.
//
// NOTE: this should be embedded by value instead of pointer to avoid a nil
// pointer dereference when methods are called.
type UnimplementedVersioningServiceServer struct{}

func (UnimplementedVersioningServiceServer) NextVersion(ctx sdk_go.ObjectContext, req *NextVersionRequest) (*NextVersionResponse, error) {
	return nil, sdk_go.TerminalError(fmt.Errorf("method NextVersion not implemented"), 501)
}
func (UnimplementedVersioningServiceServer) GetVersion(ctx sdk_go.ObjectContext, req *GetVersionRequest) (*GetVersionResponse, error) {
	return nil, sdk_go.TerminalError(fmt.Errorf("method GetVersion not implemented"), 501)
}
func (UnimplementedVersioningServiceServer) testEmbeddedByValue() {}

// UnsafeVersioningServiceServer may be embedded to opt out of forward compatibility for this service.
// Use of this interface is not recommended, as added methods to VersioningServiceServer will
// result in compilation errors.
type UnsafeVersioningServiceServer interface {
	mustEmbedUnimplementedVersioningServiceServer()
}

func NewVersioningServiceServer(srv VersioningServiceServer, opts ...sdk_go.ServiceDefinitionOption) sdk_go.ServiceDefinition {
	// If the following call panics, it indicates UnimplementedVersioningServiceServer was
	// embedded by pointer and is nil.  This will cause panics if an
	// unimplemented method is ever invoked, so we test this at initialization
	// time to prevent it from happening at runtime later due to I/O.
	if t, ok := srv.(interface{ testEmbeddedByValue() }); ok {
		t.testEmbeddedByValue()
	}
	sOpts := append([]sdk_go.ServiceDefinitionOption{sdk_go.WithProtoJSON}, opts...)
	router := sdk_go.NewObject("hydra.v1.VersioningService", sOpts...)
	router = router.Handler("NextVersion", sdk_go.NewObjectHandler(srv.NextVersion))
	router = router.Handler("GetVersion", sdk_go.NewObjectHandler(srv.GetVersion))
	return router
}
