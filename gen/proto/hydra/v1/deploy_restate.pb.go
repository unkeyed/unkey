// Code generated by protoc-gen-go-restate. DO NOT EDIT.
// versions:
// - protoc-gen-go-restate v0.1
// - protoc             (unknown)
// source: hydra/v1/deploy.proto

package hydrav1

import (
	fmt "fmt"
	sdk_go "github.com/restatedev/sdk-go"
	encoding "github.com/restatedev/sdk-go/encoding"
	ingress "github.com/restatedev/sdk-go/ingress"
)

// DeployServiceClient is the client API for hydra.v1.DeployService service.
//
// DeployService orchestrates the lifecycle of application deployments as
// durable Restate workflows. Each RPC is idempotent and can safely resume from
// any step after a crash.
//
// Deploy handles the full pipeline from building Docker images through
// provisioning containers and configuring domain routing. Rollback and Promote
// manage traffic switching between deployments by reassigning sticky frontline
// routes atomically through the routing service.
//
// ScaleDownIdlePreviewDeployments runs on a cron to find preview deployments that have
// received no traffic for 6 hours and sets them to standby. SetDeploymentDesiredState
// targets a single deployment, typically sent with a 30-minute delay after a new
// deployment replaces it.
type DeployServiceClient interface {
	// Deploy executes the full deployment workflow: build (if git source), provision
	// containers across regions, wait for health, configure domain routing, and
	// update the project's live deployment pointer for production environments.
	// Sets deployment status to failed on any error.
	Deploy(opts ...sdk_go.ClientOption) sdk_go.Client[*DeployRequest, *DeployResponse]
	// Rollback switches sticky frontline routes (environment and live) from the
	// current live deployment back to a previous one. Marks the project as rolled
	// back so future deploys don't automatically reclaim live routes.
	// Source must be the current live deployment; both must share the same project
	// and environment.
	Rollback(opts ...sdk_go.ClientOption) sdk_go.Client[*RollbackRequest, *RollbackResponse]
	// Promote reassigns sticky frontline routes to a target deployment and clears
	// the rolled-back flag, restoring normal deployment flow.
	// Target must be in ready status and not already the live deployment.
	Promote(opts ...sdk_go.ClientOption) sdk_go.Client[*PromoteRequest, *PromoteResponse]
	// ScaleDownIdlePreviewDeployments iterates all preview environments and sets any
	// deployment to standby that has received zero requests in the last 6 hours.
	// Intended to be called by a cron job.
	ScaleDownIdlePreviewDeployments(opts ...sdk_go.ClientOption) sdk_go.Client[*ScaleDownIdlePreviewDeploymentsRequest, *ScaleDownIdlePreviewDeploymentsResponse]
}

type deployServiceClient struct {
	ctx        sdk_go.Context
	workflowID string
	options    []sdk_go.ClientOption
}

func NewDeployServiceClient(ctx sdk_go.Context, workflowID string, opts ...sdk_go.ClientOption) DeployServiceClient {
	cOpts := append([]sdk_go.ClientOption{sdk_go.WithProtoJSON}, opts...)
	return &deployServiceClient{
		ctx,
		workflowID,
		cOpts,
	}
}
func (c *deployServiceClient) Deploy(opts ...sdk_go.ClientOption) sdk_go.Client[*DeployRequest, *DeployResponse] {
	cOpts := c.options
	if len(opts) > 0 {
		cOpts = append(append([]sdk_go.ClientOption{}, cOpts...), opts...)
	}
	return sdk_go.WithRequestType[*DeployRequest](sdk_go.Workflow[*DeployResponse](c.ctx, "hydra.v1.DeployService", c.workflowID, "Deploy", cOpts...))
}

func (c *deployServiceClient) Rollback(opts ...sdk_go.ClientOption) sdk_go.Client[*RollbackRequest, *RollbackResponse] {
	cOpts := c.options
	if len(opts) > 0 {
		cOpts = append(append([]sdk_go.ClientOption{}, cOpts...), opts...)
	}
	return sdk_go.WithRequestType[*RollbackRequest](sdk_go.Workflow[*RollbackResponse](c.ctx, "hydra.v1.DeployService", c.workflowID, "Rollback", cOpts...))
}

func (c *deployServiceClient) Promote(opts ...sdk_go.ClientOption) sdk_go.Client[*PromoteRequest, *PromoteResponse] {
	cOpts := c.options
	if len(opts) > 0 {
		cOpts = append(append([]sdk_go.ClientOption{}, cOpts...), opts...)
	}
	return sdk_go.WithRequestType[*PromoteRequest](sdk_go.Workflow[*PromoteResponse](c.ctx, "hydra.v1.DeployService", c.workflowID, "Promote", cOpts...))
}

func (c *deployServiceClient) ScaleDownIdlePreviewDeployments(opts ...sdk_go.ClientOption) sdk_go.Client[*ScaleDownIdlePreviewDeploymentsRequest, *ScaleDownIdlePreviewDeploymentsResponse] {
	cOpts := c.options
	if len(opts) > 0 {
		cOpts = append(append([]sdk_go.ClientOption{}, cOpts...), opts...)
	}
	return sdk_go.WithRequestType[*ScaleDownIdlePreviewDeploymentsRequest](sdk_go.Workflow[*ScaleDownIdlePreviewDeploymentsResponse](c.ctx, "hydra.v1.DeployService", c.workflowID, "ScaleDownIdlePreviewDeployments", cOpts...))
}

// DeployServiceIngressClient is the ingress client API for hydra.v1.DeployService service.
//
// This client is used to call the service from outside of a Restate context.
type DeployServiceIngressClient interface {
	// Deploy executes the full deployment workflow: build (if git source), provision
	// containers across regions, wait for health, configure domain routing, and
	// update the project's live deployment pointer for production environments.
	// Sets deployment status to failed on any error.
	Deploy() ingress.Requester[*DeployRequest, *DeployResponse]
	// Rollback switches sticky frontline routes (environment and live) from the
	// current live deployment back to a previous one. Marks the project as rolled
	// back so future deploys don't automatically reclaim live routes.
	// Source must be the current live deployment; both must share the same project
	// and environment.
	Rollback() ingress.Requester[*RollbackRequest, *RollbackResponse]
	// Promote reassigns sticky frontline routes to a target deployment and clears
	// the rolled-back flag, restoring normal deployment flow.
	// Target must be in ready status and not already the live deployment.
	Promote() ingress.Requester[*PromoteRequest, *PromoteResponse]
	// ScaleDownIdlePreviewDeployments iterates all preview environments and sets any
	// deployment to standby that has received zero requests in the last 6 hours.
	// Intended to be called by a cron job.
	ScaleDownIdlePreviewDeployments() ingress.Requester[*ScaleDownIdlePreviewDeploymentsRequest, *ScaleDownIdlePreviewDeploymentsResponse]
}

type deployServiceIngressClient struct {
	client      *ingress.Client
	serviceName string
	workflowID  string
}

func NewDeployServiceIngressClient(client *ingress.Client, workflowID string) DeployServiceIngressClient {
	return &deployServiceIngressClient{
		client,
		"hydra.v1.DeployService",
		workflowID,
	}
}

func (c *deployServiceIngressClient) Deploy() ingress.Requester[*DeployRequest, *DeployResponse] {
	codec := encoding.ProtoJSONCodec
	return ingress.NewRequester[*DeployRequest, *DeployResponse](c.client, c.serviceName, "Deploy", &c.workflowID, &codec)
}

func (c *deployServiceIngressClient) Rollback() ingress.Requester[*RollbackRequest, *RollbackResponse] {
	codec := encoding.ProtoJSONCodec
	return ingress.NewRequester[*RollbackRequest, *RollbackResponse](c.client, c.serviceName, "Rollback", &c.workflowID, &codec)
}

func (c *deployServiceIngressClient) Promote() ingress.Requester[*PromoteRequest, *PromoteResponse] {
	codec := encoding.ProtoJSONCodec
	return ingress.NewRequester[*PromoteRequest, *PromoteResponse](c.client, c.serviceName, "Promote", &c.workflowID, &codec)
}

func (c *deployServiceIngressClient) ScaleDownIdlePreviewDeployments() ingress.Requester[*ScaleDownIdlePreviewDeploymentsRequest, *ScaleDownIdlePreviewDeploymentsResponse] {
	codec := encoding.ProtoJSONCodec
	return ingress.NewRequester[*ScaleDownIdlePreviewDeploymentsRequest, *ScaleDownIdlePreviewDeploymentsResponse](c.client, c.serviceName, "ScaleDownIdlePreviewDeployments", &c.workflowID, &codec)
}

// DeployServiceServer is the server API for hydra.v1.DeployService service.
// All implementations should embed UnimplementedDeployServiceServer
// for forward compatibility.
//
// DeployService orchestrates the lifecycle of application deployments as
// durable Restate workflows. Each RPC is idempotent and can safely resume from
// any step after a crash.
//
// Deploy handles the full pipeline from building Docker images through
// provisioning containers and configuring domain routing. Rollback and Promote
// manage traffic switching between deployments by reassigning sticky frontline
// routes atomically through the routing service.
//
// ScaleDownIdlePreviewDeployments runs on a cron to find preview deployments that have
// received no traffic for 6 hours and sets them to standby. SetDeploymentDesiredState
// targets a single deployment, typically sent with a 30-minute delay after a new
// deployment replaces it.
type DeployServiceServer interface {
	// Deploy executes the full deployment workflow: build (if git source), provision
	// containers across regions, wait for health, configure domain routing, and
	// update the project's live deployment pointer for production environments.
	// Sets deployment status to failed on any error.
	Deploy(ctx sdk_go.WorkflowSharedContext, req *DeployRequest) (*DeployResponse, error)
	// Rollback switches sticky frontline routes (environment and live) from the
	// current live deployment back to a previous one. Marks the project as rolled
	// back so future deploys don't automatically reclaim live routes.
	// Source must be the current live deployment; both must share the same project
	// and environment.
	Rollback(ctx sdk_go.WorkflowSharedContext, req *RollbackRequest) (*RollbackResponse, error)
	// Promote reassigns sticky frontline routes to a target deployment and clears
	// the rolled-back flag, restoring normal deployment flow.
	// Target must be in ready status and not already the live deployment.
	Promote(ctx sdk_go.WorkflowSharedContext, req *PromoteRequest) (*PromoteResponse, error)
	// ScaleDownIdlePreviewDeployments iterates all preview environments and sets any
	// deployment to standby that has received zero requests in the last 6 hours.
	// Intended to be called by a cron job.
	ScaleDownIdlePreviewDeployments(ctx sdk_go.WorkflowSharedContext, req *ScaleDownIdlePreviewDeploymentsRequest) (*ScaleDownIdlePreviewDeploymentsResponse, error)
}

// UnimplementedDeployServiceServer should be embedded to have
// forward compatible implementations.
//
// NOTE: this should be embedded by value instead of pointer to avoid a nil
// pointer dereference when methods are called.
type UnimplementedDeployServiceServer struct{}

func (UnimplementedDeployServiceServer) Deploy(ctx sdk_go.WorkflowSharedContext, req *DeployRequest) (*DeployResponse, error) {
	return nil, sdk_go.TerminalError(fmt.Errorf("method Deploy not implemented"), 501)
}
func (UnimplementedDeployServiceServer) Rollback(ctx sdk_go.WorkflowSharedContext, req *RollbackRequest) (*RollbackResponse, error) {
	return nil, sdk_go.TerminalError(fmt.Errorf("method Rollback not implemented"), 501)
}
func (UnimplementedDeployServiceServer) Promote(ctx sdk_go.WorkflowSharedContext, req *PromoteRequest) (*PromoteResponse, error) {
	return nil, sdk_go.TerminalError(fmt.Errorf("method Promote not implemented"), 501)
}
func (UnimplementedDeployServiceServer) ScaleDownIdlePreviewDeployments(ctx sdk_go.WorkflowSharedContext, req *ScaleDownIdlePreviewDeploymentsRequest) (*ScaleDownIdlePreviewDeploymentsResponse, error) {
	return nil, sdk_go.TerminalError(fmt.Errorf("method ScaleDownIdlePreviewDeployments not implemented"), 501)
}
func (UnimplementedDeployServiceServer) testEmbeddedByValue() {}

// UnsafeDeployServiceServer may be embedded to opt out of forward compatibility for this service.
// Use of this interface is not recommended, as added methods to DeployServiceServer will
// result in compilation errors.
type UnsafeDeployServiceServer interface {
	mustEmbedUnimplementedDeployServiceServer()
}

func NewDeployServiceServer(srv DeployServiceServer, opts ...sdk_go.ServiceDefinitionOption) sdk_go.ServiceDefinition {
	// If the following call panics, it indicates UnimplementedDeployServiceServer was
	// embedded by pointer and is nil.  This will cause panics if an
	// unimplemented method is ever invoked, so we test this at initialization
	// time to prevent it from happening at runtime later due to I/O.
	if t, ok := srv.(interface{ testEmbeddedByValue() }); ok {
		t.testEmbeddedByValue()
	}
	sOpts := append([]sdk_go.ServiceDefinitionOption{sdk_go.WithProtoJSON}, opts...)
	router := sdk_go.NewWorkflow("hydra.v1.DeployService", sOpts...)
	router = router.Handler("Deploy", sdk_go.NewWorkflowSharedHandler(srv.Deploy))
	router = router.Handler("Rollback", sdk_go.NewWorkflowSharedHandler(srv.Rollback))
	router = router.Handler("Promote", sdk_go.NewWorkflowSharedHandler(srv.Promote))
	router = router.Handler("ScaleDownIdlePreviewDeployments", sdk_go.NewWorkflowSharedHandler(srv.ScaleDownIdlePreviewDeployments))
	return router
}
