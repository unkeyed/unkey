name: Artillery
description: Run artillery tests

inputs:
  target:
    description: 'The target URL to test'
    required: true
    default: 'https://api.unkey.dev'
  region:
    description: 'The aws region to test from'
    required: true
    

runs:
  using: "composite"
  

  steps:
    - name: Setup Node
      uses: actions/setup-node@v4
      with:
        node-version: lts/*

    - name: Prepare
      shell: bash
      run: |
        echo ${{ secrets.ARTILLERY_KEYS_CSV }} > .keys.csv
      working-directory: tools/artillery

    - name: Run
      shell: bash
      run: npx artillery run-lambda --record --key=${{ secrets.ARTILLERY_CLOUD_KEY }} --region ${{ input. region }} --count=10  ./keys.verifyKey.yaml 
      working-directory: tools/artillery
