// Code generated by sqlc. DO NOT EDIT.
// versions:
//   sqlc v1.27.0
// source: workflow_reset_orphaned.sql

package db

import (
	"context"
)

const resetOrphanedWorkflows = `-- name: ResetOrphanedWorkflows :exec
UPDATE workflow_executions we
SET status = 'pending' 
WHERE we.namespace = ? 
  AND we.status = 'running' 
  AND we.id NOT IN (
    SELECT l.resource_id 
    FROM leases l
    WHERE l.kind = 'workflow' AND l.namespace = ?
  )
`

type ResetOrphanedWorkflowsParams struct {
	Namespace   string `db:"namespace"`
	Namespace_2 string `db:"namespace_2"`
}

// ResetOrphanedWorkflows
//
//	UPDATE workflow_executions we
//	SET status = 'pending'
//	WHERE we.namespace = ?
//	  AND we.status = 'running'
//	  AND we.id NOT IN (
//	    SELECT l.resource_id
//	    FROM leases l
//	    WHERE l.kind = 'workflow' AND l.namespace = ?
//	  )
func (q *Queries) ResetOrphanedWorkflows(ctx context.Context, db DBTX, arg ResetOrphanedWorkflowsParams) error {
	_, err := db.ExecContext(ctx, resetOrphanedWorkflows, arg.Namespace, arg.Namespace_2)
	return err
}
