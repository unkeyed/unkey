post:
  tags:
    - identities
  summary: Update identity credits
  description: |
    Update credit quotas for an identity in response to plan changes, billing cycles, or usage purchases.

    Use this for user upgrades/downgrades, monthly quota resets, credit purchases, or promotional bonuses. Supports three operations: set, increment, or decrement credits. Set to null for unlimited usage.

    Identity credits are shared across all keys belonging to the identity and take priority over key-level credits during verification.

    **Important**: Setting unlimited credits automatically clears existing refill configurations.

    **Required Permissions**

    Your root key must have one of the following permissions:
    - `identity.*.update_identity` (to update any identity)
    - `identity.<identity_id>.update_identity` (to update a specific identity)

    **Side Effects**

    Credit updates take effect immediately. Setting credits to unlimited automatically clears any existing refill settings. Changes propagate instantly but may take up to 30 seconds to reach all edge regions.
  operationId: updateIdentityCredits
  x-speakeasy-name-override: updateIdentityCredits
  security:
    - rootKey: []
  requestBody:
    required: true
    content:
      application/json:
        schema:
          "$ref": "./V2IdentitiesUpdateCreditsRequestBody.yaml"
  responses:
    "200":
      description: |
        Credits updated successfully. Response includes updated remaining credits and refill settings.
      content:
        application/json:
          schema:
            "$ref": "./V2IdentitiesUpdateCreditsResponseBody.yaml"
    "400":
      description: Bad request
      content:
        application/json:
          schema:
            "$ref": "../../../../error/BadRequestErrorResponse.yaml"
    "401":
      description: Unauthorized
      content:
        application/json:
          schema:
            "$ref": "../../../../error/UnauthorizedErrorResponse.yaml"
    "403":
      description: Forbidden
      content:
        application/json:
          schema:
            "$ref": "../../../../error/ForbiddenErrorResponse.yaml"
    "404":
      description: Not found
      content:
        application/json:
          schema:
            "$ref": "../../../../error/NotFoundErrorResponse.yaml"
    "500":
      description: Internal server error
      content:
        application/json:
          schema:
            "$ref": "../../../../error/InternalServerErrorResponse.yaml"
